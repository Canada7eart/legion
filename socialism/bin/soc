#!/usr/bin/env python2
from __future__ import print_function, with_statement, division, generators

import os, sys, argparse, re

# path business
if os.path.exists("/Users/jules"):
    sys.path.append("/Users/jules/Documents/LISA/task")
    sys.path.append("/Users/jules/Documents/LISA/DistributedDropout/")
else:
    dom_name = re.sub("\s", "", os.popen("dnsdomainname").read())
    if dom_name in {"helios", "guillimin.clumeq.ca"} and os.path.exists("/home/julesgm/"):
        sys.path.append("/home/julesgm/task/")
        sys.path.append("/home/julesgm/DistributedDropout")

from socialism import benevolant_dictator

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('--path',             type=str)
    parser.add_argument('--nodes',  type=int)
    parser.add_argument('--gpus',   type=int)

    # Optional
    parser.add_argument('--walltime',         type=str, default="12:00:00")

    parser.add_argument('--debug',                        default=False, action="store_true")
    parser.add_argument('--debug_pycharm',                default=False, action="store_true")

    parser.add_argument('--allocation_name',  type=str, default="jvb-000-aa")
    parser.add_argument('--job_name',         type=str, default="[Unspecified]")
    parser.add_argument('--user_script_args', type=str, default="")

    args = parser.parse_args()

    assert not args.debug_pycharm or (args.debug and args.debug_pycharm), "The --debug flag must be activated to use the --debug_pycharm flag"

    soc = benevolant_dictator.Server()
    soc.launch_clients(
        user_script_path= args.path,
        walltime=         args.walltime,
        job_name=         args.job_name,
        number_of_nodes=  args.number_of_nodes,
        number_of_gpus=   args.number_of_gpus,
        allocation_name=  args.allocation_name,
        user_script_args= args.user_script_args,
        debug=            args.debug,
        debug_pycharm=    args.debug_pycharm
        )


    print("launcher - done")